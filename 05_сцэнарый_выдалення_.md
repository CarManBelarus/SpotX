# Chapter 5: Сцэнарый выдалення


Сардэчна запрашаем у пятую главу нашага падручніка па `Патчар SpotX для Spotify`! У [папярэдніх раздзелах](04_логіка_патчавання_файлаў_spotify_.md) мы падрабязна разгледзелі, як SpotX усталёўвае Spotify, апрацоўвае вашыя інструкцыі праз [параметры](03_апрацоўка_параметраў_.md) і выкарыстоўвае [логіку патчавання](04_логіка_патчавання_файлаў_spotify_.md) для мадыфікацыі файлаў праграмы.

Але што рабіць, калі вы вырашылі больш не выкарыстоўваць SpotX або хочаце цалкам ачысціць Spotify ад любых змен, зробленых патчарам? Тут на дапамогу прыходзіць **Сцэнарый выдалення**.

## Што такое Сцэнарый выдалення і навошта ён патрэбны?

Уявіце, што пасля рамонту (патчавання SpotX) у вас засталіся інструменты, рэзервовыя дэталі і, магчыма, некаторы беспарадак. Сцэнарый выдалення — гэта як "прыбіральшчык", які прыходзіць, каб усё прыбраць і вярнуць рэчы на свае месцы.

Калі SpotX патчуе файлы Spotify, ён часта стварае **рэзервовыя копіі** арыгінальных файлаў (звычайна з пашырэннем `.bak`) і можа пакідаць часовыя файлы або дадаваць новыя.

**Галоўная задача Сцэнарыя выдалення** — адмяніць гэтыя змены. Ён шукае рэзервовыя копіі, аднаўляе іх на месца арыгіналаў і выдаляе ўсё, што было дададзена або зменена SpotX (наколькі гэта магчыма).

Гэты сцэнарый патрэбны, калі вы хочаце:

*   Цалкам выдаліць усе сляды SpotX і яго зменаў.
*   Вярнуць Spotify да яго першапачатковага стану перад патчаваннем.
*   Падрыхтавацца да чыстай пераўсталёўкі Spotify або SpotX.

## Як выкарыстоўваць Сцэнарый выдалення?

Самы просты і асноўны спосаб выкарыстоўваць сцэнарый выдалення — гэта запусціць спецыяльны файл `Uninstall.bat`, які знаходзіцца ў галоўнай тэчцы праекта SpotX (там жа, дзе `Install.bat`, `run.ps1` і г.д.).

Проста знайдзіце файл `Uninstall.bat` у правадыру файлаў, пстрыкніце па ім правай кнопкай мышы і выберыце "Запусціць ад імя адміністратара" (гэта часта неабходна, бо сцэнарый працуе з файламі праграмы).

Калі вы запусціце `Uninstall.bat`, ён аўтаматычна паспрабуе выканаць усе неабходныя дзеянні для выдалення SpotX-зменаў. Вам не трэба ўводзіць параметры або адказваць на пытанні.

## Што адбываецца ўнутры? (Спрошчана)

Сцэнарый `Uninstall.bat` выконвае шэраг простых крокаў для аднаўлення:

1.  Ён правярае, ці існуюць пэўныя файлы або тэчкі, звязаныя са зменамі SpotX або яго рэзервовымі копіямі.
2.  Калі ён знаходзіць рэзервовую копію арыгінальнага файла (напрыклад, `Spotify.bak` або `xpui.bak`), ён спачатку выдаляе бягучы (патчаны) файл, а затым пераймяноўвае рэзервовую копію, вяртаючы ёй арыгінальнае імя.
3.  Калі ён знаходзіць іншыя файлы, дададзеныя SpotX (напрыклад, `dpapi.dll`, `config.ini`, `blockthespot_log.txt`), ён проста іх выдаляе.
4.  Ён таксама шукае і выдаляе часовыя тэчкі, якія мог стварыць SpotX падчас працы.
5.  У канцы ён вывесці паведамленне пра паспяховае завяршэнне.

Вось як гэта выглядае на спрошчанай схеме:

```mermaid
sequenceDiagram
    participant Карыстальнік
    participant Uninstall.bat як СцэнарыйВыдалення
    participant SpotifyFiles як ФайлыSpotify (.exe, .spa, .bak, etc.)
    participant SystemFiles як ЧасовыяФайлы

    Карыстальнік->>СцэнарыйВыдалення: Запуск Uninstall.bat (як адміністратар)
    СцэнарыйВыдалення->>SpotifyFiles: Праверыць наяўнасць Spotify.bak
    SpotifyFiles-->>СцэнарыйВыдалення: Інфармацыя аб файле
    opt Калі Spotify.bak існуе
        СцэнарыйВыдалення->>SpotifyFiles: Выдаліць Spotify.exe
        СцэнарыйВыдалення->>SpotifyFiles: Перайменаваць Spotify.bak у Spotify.exe
    end
    СцэнарыйВыдалення->>SpotifyFiles: Праверыць наяўнасць xpui.bak
    SpotifyFiles-->>СцэнарыйВыдалення: Інфармацыя аб файле
    opt Калі xpui.bak існуе
        СцэнарыйВыдалення->>SpotifyFiles: Выдаліць xpui.spa
        СцэнарыйВыдалення->>SpotifyFiles: Перайменаваць xpui.bak у xpui.spa
    end
    СцэнарыйВыдалення->>SpotifyFiles: Выдаліць dpapi.dll (калі існуе)
    СцэнарыйВыдалення->>SpotifyFiles: Выдаліць config.ini (калі існуе)
    СцэнарыйВыдалення->>SpotifyFiles: Выдаліць blockthespot_log.txt (калі існуе)
    СцэнарыйВыдалення->>SystemFiles: Выдаліць часовыя папкі SpotX (калі існуюць)
    СцэнарыйВыдалення->>Карыстальнік: Вывесці паведамленне "Patch successfully removed" (Арыгінал у бат-файле)
```

Гэтая схема паказвае, што сцэнарый выдалення ў асноўным займаецца пошукам і аднаўленнем файлаў з рэзервовых копій і выдаленнем лішніх файлаў.

## Зазірнем у код `Uninstall.bat`

Файл `Uninstall.bat` — гэта просты сцэнарый, які выконвае каманды адна за адной. Вось некалькі ключавых фрагментаў, якія паказваюць, як ён працуе:

**1. Выдаленне `dpapi.dll`:**

```bat
if exist "%Appdata%\Spotify\dpapi.dll" (
    del /s /q "%Appdata%\Spotify\dpapi.dll" > NUL 2>&1
)
```

*   `if exist "%Appdata%\Spotify\dpapi.dll"`: Гэты радок правярае, ці існуе файл `dpapi.dll` у тэчцы Spotify у AppData. SpotX можа выкарыстоўваць гэты файл для пэўных функцый.
*   `del /s /q ...`: Калі файл знойдзены, гэтая каманда выдаляе яго. `/s` азначае выдаленне ва ўсіх падпапках (хоць тут не актуальна для аднаго файла), а `/q` — выдаленне без запыту пацверджання.
*   `> NUL 2>&1`: Гэта пера накіроўвае любы вывад (у тым ліку памылкі) каманды `del` у "пустату", каб яны не адлюстроўваліся на экране і не перашкаджалі карыстальніку.

**2. Аднаўленне `Spotify.exe` з рэзервовай копіі:**

```bat
if exist "%Appdata%\Spotify\Spotify.bak" (
    del /s /q "%Appdata%\Spotify.exe" > NUL 2>&1
    move "%Appdata%\Spotify\Spotify.bak" "%Appdata%\Spotify\Spotify.exe" > NUL 2>&1
)
```

*   `if exist "%Appdata%\Spotify\Spotify.bak"`: Правярае, ці існуе рэзервовая копія выканальнага файла Spotify.
*   `del /s /q "%Appdata%\Spotify.exe"`: Калі рэзервовая копія знойдзена, выдаляе бягучы (патчаны) `Spotify.exe`.
*   `move "%Appdata%\Spotify\Spotify.bak" "%Appdata%\Spotify\Spotify.exe"`: Пераймяноўвае `Spotify.bak` у `Spotify.exe`, тым самым аднаўляючы арыгінальны файл.

**3. Аднаўленне `xpui.spa` з рэзервовай копіі:**

```bat
if exist "%Appdata%\Spotify\Apps\xpui.bak" (
    del /s /q "%Appdata%\Spotify\Apps\xpui.spa" > NUL 2>&1
    move "%Appdata%\Spotify\Apps\xpui.bak" "%Appdata%\Spotify\Apps\xpui.spa" > NUL 2>&1
)
```

Гэты фрагмент працуе аналагічна папярэдняму, але для файла `xpui.spa`, які змяшчае інтэрфейс Spotify.

**4. Выдаленне `config.ini` і файла лога:**

```bat
if exist "%Appdata%\Spotify\config.ini" (
    del /s /q "%Appdata%\Spotify\config.ini" > NUL 2>&1
)

if exist "%Appdata%\Spotify\blockthespot_log.txt" (
    del /s /q "%Appdata%\Spotify\blockthespot_log.txt" > NUL 2>&1
)
```

Гэтыя радкі проста выдаляюць канфігурацыйны файл і файл лога, якія мог стварыць SpotX або звязаныя з ім інструменты.

**5. Выдаленне часовых тэчак:**

```bat
if exist "%temp%\SpotX_Temp*" (
    for /d %%i in ("%temp%\SpotX_Temp*") do (
        rd /s/q "%%i" > NUL 2>&1
    )
)
```

*   `if exist "%temp%\SpotX_Temp*"`: Правярае, ці існуюць якія-небудзь тэчкі ў часовым каталогу (`%temp%`), імёны якіх пачынаюцца з "SpotX_Temp".
*   `for /d %%i in ("%temp%\SpotX_Temp*") do (...)`: Гэта цыкл, які перабірае ўсе знойдзеныя тэчкі.
*   `rd /s/q "%%i"`: Для кожнай знойдзенай тэчкі (`%%i`) выконвае каманду `rd` (remove directory), каб выдаліць яе. `/s` выдаляе ўсе падпапкі і файлы, а `/q` робіць гэта без запыту.

Гэтыя фрагменты паказваюць, што сцэнарый выдалення — гэта прамы набор каманд, прызначаных для пошуку і ліквідацыі канкрэтных файлаў і рэзервовых копій, створаных працэсам патчавання. Ён не змяшчае складанай логікі або інтэрактыўных пытанняў, проста спрабуе ачысціць усё, што ведае пра SpotX-змены.

## Высновы

Сцэнарый выдалення — гэта важны кампанент `Патчар SpotX для Spotify`, які дазваляе лёгка адмяніць змены, зробленыя праграмай. Запускаючы просты файл `Uninstall.bat`, вы запускаеце аўтаматызаваны працэс, які шукае рэзервовыя копіі арыгінальных файлаў Spotify і іншыя сляды SpotX, аднаўляе файлы з бэкапаў і выдаляе лішнія элементы. Гэта дапамагае вярнуць вашу ўстаноўку Spotify у стан, блізкі да арыгінальнага.

У наступнай главе мы паглыбімся ў **Устаўленыя дапаможныя сцэнарыі** — меншыя часткі кода, якія ўбудоўваюцца або выклікаюцца Галоўным сцэнарыем, каб выканаць пэўныя спецыялізаваныя задачы падчас патчавання.

[Глава 6: Устаўленыя дапаможныя сцэнарыі](06_устаўленыя_дапаможныя_сцэнарыі_.md)

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)